<!DOCTYPE html>
<html>
<head>
  <title>Video Streaming</title>
</head>
<body>
  <h1>Video Streaming</h1>
  
  <video id="localVideo" autoplay></video>
  <video id="remoteVideo" autoplay></video>
  
  <script>
    // Get the local video element
    const localVideo = document.getElementById('localVideo');
    
    // Get the remote video element
    const remoteVideo = document.getElementById('remoteVideo');
    
    // Create a peer connection
    const pc = new RTCPeerConnection();
    
    // Get the user's media
    navigator.mediaDevices.getUserMedia({
      video: true,
      audio: true
    })
    .then(stream => {
      // Display the local video stream
      localVideo.srcObject = stream;
      
      // Add the local stream to the peer connection
      stream.getTracks().forEach(track => {
        pc.addTrack(track, stream);
      });
      
      // Set up the data channel for streaming
      const dataChannel = pc.createDataChannel('stream');
      
      // Handle incoming data channel messages
      dataChannel.onmessage = event => {
        const data = event.data;
        // Display the received data as video stream
        remoteVideo.srcObject = data;
      };
      
      // Create an offer
      pc.createOffer()
      .then(offer => {
        return pc.setLocalDescription(offer);
      })
      .then(() => {
        // Generate a QR code for the offer
        const qrCode = new QRCode('qrCode', {
          text: JSON.stringify(pc.localDescription),
          width: 200,
          height: 200,
          colorDark: '#000000',
          colorLight: '#ffffff',
          correctLevel: QRCode.CorrectLevel.H
        });
        
        // Display the QR code
        document.getElementById('qrCode').innerHTML = qrCode.toString();
      });
      
      // Handle the remote stream
      pc.addEventListener('track', event => {
        remoteVideo.srcObject = event.streams[0];
      });
    })
    .catch(error => {
      console.error('Error accessing media devices:', error);
    });
  </script>
  
  <div id="qrCode"></div>
</body>
</html>
