<!DOCTYPE html>
<html>
<head>
  <title>Video Streaming</title>
</head>
<body>
  <h1>Video Streaming</h1>
  
  <video id="localVideo" autoplay></video>
  <video id="remoteVideo" autoplay></video>
  
  <button id="generateQRButton">Generate QR Code</button>
  <div id="qrCode"></div>
  
  <script src="https://cdn.jsdelivr.net/npm/qrcode@8.0.0/dist/qrcode.min.js"></script>
  <script>
    // Get the local video element
    const localVideo = document.getElementById('localVideo');
    
    // Get the remote video element
    const remoteVideo = document.getElementById('remoteVideo');
    
    // Create a peer connection
    const pc = new RTCPeerConnection();
    
    // Get the user's media
    navigator.mediaDevices.getUserMedia({
      video: true,
      audio: true
    })
    .then(stream => {
      // Display the local video stream
      localVideo.srcObject = stream;
      
      // Add the local stream to the peer connection
      stream.getTracks().forEach(track => {
        pc.addTrack(track, stream);
      });
      
      // Set up the data channel for streaming
      const dataChannel = pc.createDataChannel('stream');
      
      // Handle incoming data channel messages
      dataChannel.onmessage = event => {
        const data = event.data;
        // Display the received data as video stream
        remoteVideo.srcObject = data;
      };
    })
    .catch(error => {
      console.error('Error accessing media devices:', error);
    });
    
    // Generate the QR code when the button is clicked
    document.getElementById('generateQRButton').addEventListener('click', () => {
      // Create an offer
      pc.createOffer()
      .then(offer => {
        return pc.setLocalDescription(offer);
      })
      .then(() => {
        // Generate a QR code for the offer
        const qrCode = new QRCode('qrCode', {
          text: JSON.stringify(pc.localDescription),
          width: 200,
          height: 200,
          colorDark: '#000000',
          colorLight: '#ffffff',
          correctLevel: QRCode.CorrectLevel.H
        });
        
        // Display the QR code
        document.getElementById('qrCode').innerHTML = qrCode.toString();
      });
    });
  </script>
</body>
</html>
